//functional
import Image from "next/image";
import Head from "next/head";

//component
import LogoSmall from "./components/logoSmall";
import SearchForm from "./components/searchForm";
import Keyword from "./components/keyword";
import BannerMain from "./components/bannerMain";
import Category from "./components/category";
import CategoryM from "./components/categoryM";
import VideoAd from "./components/videoAd";
import Footer from "./components/footer";
import ResultList from "./components/resultList";

const Result = (props) => {
    const locationMain = (e) => {
        location.href = process.env.NEXT_PUBLIC_API_URL;
    };

    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    let queryValue = getParameterByName('q');

    if (props != undefined && props != null && props.result != "없음") {
        return (
            <>
                <Head>
                    <title>Videoowl | 종합 컨텐츠 큐레이션 플랫폼</title>
                    <meta
                        name="description"
                        content="Generated by create next app"
                    />
                    <link rel="icon" href="/image/logo/logo_small.svg" />
                </Head>

                {/* {props.result} */}
                <div className="bg-slate-900 overflow-hidden">
                    <div className="relative flex justify-center pt-7">
                        <div className="w-full md:w-[60%] flex justify-center items-center">
                            <div
                                className="md:w-[180px] md:h-[80px] lg:w-[200px] lg:h-[100px] 2xl:w-[350px] 2xl:h-[150px] mr-8 relative hidden md:flex md:cursor-pointer"
                                onClick={locationMain}
                            >
                                <Image
                                    src="/image/logo/logo_dark_border.png"
                                    alt="logo"
                                    layout="fill"
                                    objectFit="contain"
                                ></Image>
                            </div>
                            <div
                                className="block mr-3 md:hidden cursor-pointer"
                                onClick={locationMain}
                            >
                                <LogoSmall></LogoSmall>
                            </div>
                            <div className="w-[75%]">
                                <SearchForm></SearchForm>
                                <div className="hidden md:flex">
                                    <Keyword></Keyword>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="relative flex justify-center items-center pb-7">
                        <div className="w-full md:w-[58%]">
                            <BannerMain></BannerMain>
                        </div>
                    </div>
                    
                    {/* 카테고리 웹 */}
                    <div className="relative hidden md:flex md:flex-col md:justify-center md:py-7">
                        {
                            props.result.length > 0 && props != undefined ? <Category props={props} queryValue={queryValue}></Category> : ''
                        }
                    </div>
                    {/* 카테고리 모바일 */}
                    <div className="relative flex flex-col justify-center py-7 md:hidden">
                        {
                            props.result.length > 0 && props != undefined ? <CategoryM props={props} queryValue={queryValue}></CategoryM> : ''
                        }
                    </div>

                    {/* <div className="relative flex justify-center py-7">
                        <VideoAd></VideoAd>
                    </div>
                    <div className="relative flex justify-center">
                        {
                            props.result.length > 0 && props != undefined ? <ResultList props={props.result}/> : ''
                        }
                    </div> */}
                    <div className="w-full sm:w-[90%] md:w-[80%] lg:w-[70%] xl:w-[65%] 2xl:w-[60%] mx-auto flex-1 p-3 relative">
                        <Footer></Footer>
                    </div>
                </div>
            </>
        );
    } else {
        return (
            <>
                {/* {props.result} */}
                <div className="bg-slate-900 overflow-hidden">
                    <div className="relative flex justify-center pt-7">
                        <div className="w-full md:w-[60%] flex justify-center items-center">
                            <div
                                className="md:w-[180px] md:h-[80px] lg:w-[200px] lg:h-[100px] 2xl:w-[350px] 2xl:h-[150px] mr-8 relative hidden md:flex md:cursor-pointer"
                                onClick={locationMain}
                            >
                                <Image
                                    src="/image/logo/logo_dark_border.png"
                                    alt="logo"
                                    layout="fill"
                                    objectFit="contain"
                                ></Image>
                            </div>
                            <div
                                className="block mr-3 md:hidden cursor-pointer"
                                onClick={locationMain}
                            >
                                <LogoSmall></LogoSmall>
                            </div>
                            <div className="w-[75%]">
                                <SearchForm></SearchForm>
                                <div className="hidden md:flex">
                                    <Keyword></Keyword>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="relative flex justify-center items-center pb-7">
                        <div className="w-full md:w-[58%]">
                            <BannerMain></BannerMain>
                        </div>
                    </div>
                    <div className="relative flex justify-center py-7">
                        <VideoAd></VideoAd>
                    </div>
                    <div className="relative flex justify-center"></div>
                    <div className="h-40"></div>
                    <Footer></Footer>
                </div>
            </>
        );
    }
};

export async function getServerSideProps(context) {
    const res = await fetch(
        process.env.NEXT_PUBLIC_API_URL + `api/result?q=` + context.query.q
    );
    const data = await res.json();
    return { props: data };
}

export default Result;
